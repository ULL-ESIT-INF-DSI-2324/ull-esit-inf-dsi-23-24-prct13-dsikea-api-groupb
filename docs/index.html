<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>proyecto-final-dsi-grupo-b</title><meta name="description" content="Documentation for proyecto-final-dsi-grupo-b"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">proyecto-final-dsi-grupo-b</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>proyecto-final-dsi-grupo-b</h2></div><div class="tsd-panel tsd-typography"><ul>
<li><p>Autores: <strong>Omar Su√°rez Doro - <a href="mailto:alu0101483474@ull.edu.es">alu0101483474@ull.edu.es</a> ; Antonio Ramos Castilla - <a href="mailto:alu0101480367@ull.edu.es">alu0101480367@ull.edu.es</a> ; Ithaisa Morales Arbelo - <a href="mailto:alu0101482194@ull.edu.es">alu0101482194@ull.edu.es</a></strong></p>
</li>
<li><p>Asignatura: <strong>Desarrollo de Sistemas Inform√°ticos</strong></p>
</li>
</ul>
<a id="md:√≠ndice" class="tsd-anchor"></a><h1><a href="#md:√≠ndice">√çndice</a></h1><ul>
<li><a href="#md:1--introducci√≥n-">1. üìö Introducci√≥n üìö</a></li>
<li><a href="#md:2--trabajo-previo-">2. üß† Trabajo previo üß†</a></li>
<li><a href="#md:3-Ô∏è-desarrollo-de-la-pr√°ctica-Ô∏è">3. üñ•Ô∏è Desarrollo de la pr√°ctica üñ•Ô∏è</a></li>
<li><a href="#md:4-conclusiones">4. Conclusiones</a></li>
<li><a href="#md:5-referencias">5. Referencias</a></li>
</ul>
<a id="md:1-üìö-introducci√≥n-üìö" class="tsd-anchor"></a><h1><a href="#md:1-üìö-introducci√≥n-üìö">1. üìö Introducci√≥n üìö</a></h1><p>El prop√≥sito de este informe es detallar los procedimientos llevados a cabo en el transcurso de la pr√°ctica n√∫mero 13 del curso de <strong>Desarrollo de Sistemas Inform√°ticos</strong>.</p>
<a id="md:2-üß†-trabajo-previo-üß†" class="tsd-anchor"></a><h1><a href="#md:2-üß†-trabajo-previo-üß†">2. üß† Trabajo previo üß†</a></h1><p>Para la realizaci√≥n de esta pr√°ctica, se han realizado las siguientes tareas como trabajo previo:</p>
<ul>
<li>Lectura y compresi√≥n de los apuntes de la asignatura, junto a la b√∫squeda de informaci√≥n en la documentaci√≥n del framework <a href="https://expressjs.com/es/guide/routing.html">Express</a>.</li>
<li>Entender el funcionamiento de MongoDB y Mongoose.</li>
<li>Saber c√≥mo utilizar Atlas y Render para su desplegue web.</li>
</ul>
<a id="md:3-üñ•Ô∏è-desarrollo-de-la-pr√°ctica-üñ•Ô∏è" class="tsd-anchor"></a><h1><a href="#md:3-üñ•Ô∏è-desarrollo-de-la-pr√°ctica-üñ•Ô∏è">3. üñ•Ô∏è Desarrollo de la pr√°ctica üñ•Ô∏è</a></h1><p>En esta fase, se ha implementado el servidor utilizando Express para replicar la funcionalidad previa. Se ha integrado MongoDB y Mongoose para gestionar la base de datos de manera eficiente. Adem√°s, se ha desplegado la aplicaci√≥n web utilizando MongoDB Atlas y Render, asegurando una configuraci√≥n √≥ptima y una f√°cil gesti√≥n del entorno de producci√≥n.</p>
<ul>
<li><strong>getModels.ts</strong>: Permite obtener el modelo de transacci√≥n correspondiente seg√∫n un tipo dado, como compra, venta o devoluci√≥n. El vector transactionsModels exportada contiene todos los modelos de transacciones disponibles en el sistema, facilitando el acceso a ellos desde otros m√≥dulos.</li>
</ul>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">getModel</span><span class="hl-1">(</span><span class="hl-4">tipo</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">tipo</span><span class="hl-1">.</span><span class="hl-3">toLowerCase</span><span class="hl-1">()) {</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-6">&#39;compra&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">compraModel</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-6">&#39;venta&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">ventaModel</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-6">&#39;devolucion&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">devolucionModel</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;Tipo de transacci√≥n no soportado&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">transactionsModels</span><span class="hl-1">: </span><span class="hl-5">any</span><span class="hl-1">[] = [</span><span class="hl-4">transaccionModel</span><span class="hl-1">, </span><span class="hl-4">devolucionModel</span><span class="hl-1">, </span><span class="hl-4">ventaModel</span><span class="hl-1">];</span>
</code><button>Copy</button></pre>
<ul>
<li><p><strong>db.ts</strong>: Establece una conexi√≥n a una base de datos MongoDB y proporciona manejo de errores b√°sico.</p>
<pre><code class="language-ts"><span class="hl-7">// Connect to Database</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-3">iniciarDB</span><span class="hl-1"> = () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">connect</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-8">MONGODB_URL</span><span class="hl-1">!).</span><span class="hl-3">then</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-6">&#39;Connected to the database&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  }).</span><span class="hl-3">catch</span><span class="hl-1">(() </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-6">&#39;Something went wrong when conecting to the database&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-3">exit</span><span class="hl-1">(-</span><span class="hl-9">1</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>mueble.ts</strong>: Se proporciona una definici√≥n de esquema y un modelo para interactuar con una colecci√≥n de muebles en una base de datos MongoDB utilizando Mongoose.</p>
<ol>
<li>Tipo Dimension: Define una estructura para representar las dimensiones de un mueble, incluyendo alto, ancho y largo.</li>
<li>Interfaz MuebleDocumentInterface: Define la estructura de un documento de la colecci√≥n de Muebles, especificando las propiedades esperadas como id, tipo, nombre, etc.</li>
<li>Esquema DimensionSchema: Define la estructura del subdocumento para las dimensiones de un mueble, utilizando el tipo definido previamente y los tipos de datos proporcionados por Mongoose.</li>
<li>Esquema MuebleSchema: Define la estructura completa de un documento de la colecci√≥n de Muebles, con campos como id, nombre, material, etc. Se aplican validaciones y restricciones a cada campo.</li>
</ol>
<pre><code class="language-ts"><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-5">Dimension</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">alto</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">ancho</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">largo</span><span class="hl-1">: </span><span class="hl-5">number</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-5">MuebleDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-5">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id_</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">tipo_</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">nombre_</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">material_</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">descripcion_</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dimensiones_</span><span class="hl-1">: </span><span class="hl-5">Dimension</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">color_</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">precio_</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">cantidad_</span><span class="hl-1">: </span><span class="hl-5">number</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">DimensionSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">&lt;</span><span class="hl-5">Dimension</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">alto:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">ancho:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">largo:</span><span class="hl-1"> </span><span class="hl-4">Number</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">MuebleSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">&lt;</span><span class="hl-5">MuebleDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,  </span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El id de un mueble no puede ser negativo.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> % </span><span class="hl-9">1</span><span class="hl-1"> !== </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El id de un mueble no puede ser un n√∫mero decimal.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">nombre_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El nombre de un mueble no puede ser vac√≠o.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-10">/\d/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El nombre de un mueble no puede contener n√∫meros.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">material_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">enum:</span><span class="hl-1"> [</span><span class="hl-6">&#39;madera&#39;</span><span class="hl-1">, </span><span class="hl-6">&#39;pl√°stico&#39;</span><span class="hl-1">, </span><span class="hl-6">&#39;metal&#39;</span><span class="hl-1">, </span><span class="hl-6">&#39;vidrio&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">descripcion_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La descripci√≥n de un mueble no puede ser vac√≠a.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-3">endsWith</span><span class="hl-1">(</span><span class="hl-6">&#39;.&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La descripci√≥n de un mueble tiene que acabar con un punto.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">dimensiones_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">DimensionSchema</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">Dimension</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">alto</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">ancho</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">largo</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;Las dimensiones de un mueble no pueden ser negativas.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    } </span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">cantidad_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La cantidad de un mueble no puede ser negativa.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> % </span><span class="hl-9">1</span><span class="hl-1"> !== </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La cantidad de un mueble no puede ser un n√∫mero decimal.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">color_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El color de un mueble no puede ser vac√≠o.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-10">/\d/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El color de un mueble no puede contener n√∫meros.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }, </span><br/><span class="hl-1">  </span><span class="hl-4">precio_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La cantidad de un mueble no puede ser negativa.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> % </span><span class="hl-9">1</span><span class="hl-1"> !== </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La cantidad de un mueble no puede ser un n√∫mero decimal.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">tipo_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">enum:</span><span class="hl-1"> [</span><span class="hl-6">&#39;silla&#39;</span><span class="hl-1">, </span><span class="hl-6">&#39;mesa&#39;</span><span class="hl-1">, </span><span class="hl-6">&#39;armario&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">muebleModel</span><span class="hl-1"> = </span><span class="hl-3">model</span><span class="hl-1">&lt;</span><span class="hl-5">MuebleDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-6">&#39;Mueble&#39;</span><span class="hl-1">, </span><span class="hl-4">MuebleSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>silla.ts, mesa.ts, armario.ts</strong>: Proporcionan c√≥digo que heredan del mismo origen, la interfaz MuebleDocumentInterface, lo que les proporciona propiedades comunes como id, tipo, nombre, etc. Cada esquema de mueble (SillaSchema, MesasSchema y ArmarioSchema) define la estructura espec√≠fica de cada tipo de mueble, con validaciones y tipos de datos espec√≠ficos. Aunque comparten la misma base, cada tipo de mueble introduce atributos √∫nicos: las sillas tienen respaldo_ y reposabrazos_, las mesas tienen extensible_ y sillas_, mientras que los armarios tienen cajones_ y puertas_. Estos modelos se crean utilizando muebleModel.discriminator basado en el modelo principal de muebles y el esquema espec√≠fico de cada tipo, permitiendo una estructura modular y extensible para gestionar diferentes tipos de muebles en la base de datos.</p>
<blockquote>
<p>C√≥digo de Ejemplo: silla.ts</p>
</blockquote>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-5">SillaDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-5">MuebleDocumentInterface</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">respaldo_</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">reposabrazos_</span><span class="hl-1">: </span><span class="hl-5">boolean</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">SillaSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">&lt;</span><span class="hl-5">SillaDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">respaldo_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Boolean</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">reposabrazos_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Boolean</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">sillaModel</span><span class="hl-1"> = </span><span class="hl-4">muebleModel</span><span class="hl-1">.</span><span class="hl-3">discriminator</span><span class="hl-1">(</span><span class="hl-6">&#39;Sillas&#39;</span><span class="hl-1">, </span><span class="hl-4">SillaSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>persona.ts</strong>: Define un modelo y un esquema para una colecci√≥n de personas en una base de datos MongoDB utilizando Mongoose.</p>
<ol>
<li>Interfaz PersonaDocumentInterface: Define la estructura de un documento de la colecci√≥n de Personas, especificando propiedades como id, nombre, contacto y direcci√≥n.</li>
<li>Esquema PersonaSchema: Define la estructura completa de un documento de la colecci√≥n de Personas. Cada campo del esquema especifica el tipo de datos, si es √∫nico y requerido, y contiene funciones de validaci√≥n para asegurar la integridad de los datos ingresados.</li>
<li>Modelo personaModel: Exporta el modelo de Mongoose para la colecci√≥n de Personas, utilizando el esquema definido previamente. Este modelo se registra en la base de datos con el nombre &quot;Personas&quot;.</li>
</ol>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-5">PersonaDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-5">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id_</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">nombre_</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">contacto_</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">direccion_</span><span class="hl-1">: </span><span class="hl-5">string</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">PersonaSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">&lt;</span><span class="hl-5">PersonaDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El ID de una persona no puede ser vac√≠o.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-9">9</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El ID de una persona debe tener 9 caracteres.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-10">/</span><span class="hl-11">^</span><span class="hl-10">\d</span><span class="hl-12">{8}</span><span class="hl-10">\w</span><span class="hl-12">{1}</span><span class="hl-11">$</span><span class="hl-10">/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El ID de una persona debe tener un formato v√°lido: [8 d√≠gitos][1 letras may√∫sculas].&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">nombre_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El nombre de una persona no puede ser vac√≠o.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-10">/\d/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El nombre de una persona no puede contener n√∫meros.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-10">/</span><span class="hl-11">^</span><span class="hl-13">[</span><span class="hl-10">A-Z</span><span class="hl-13">]</span><span class="hl-10">/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El nombre de una persona debe empezar por may√∫scula.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    } </span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">contacto_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El contacto de una persona no puede ser negativo.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> % </span><span class="hl-9">1</span><span class="hl-1"> !== </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El contacto de una persona no puede ser un n√∫mero decimal.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-3">toString</span><span class="hl-1">().</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-9">9</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El contacto de una persona debe tener 9 d√≠gitos.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-10">/</span><span class="hl-11">^</span><span class="hl-13">[</span><span class="hl-10">6-9</span><span class="hl-13">]</span><span class="hl-10">/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-3">toString</span><span class="hl-1">())) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El contacto de una persona debe empezar por 6,7,8 9.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">direccion_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La direcci√≥n de una persona no puede ser vac√≠a.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-10">/</span><span class="hl-11">^</span><span class="hl-13">[</span><span class="hl-10">a-zA-Z0-9\s</span><span class="hl-13">]</span><span class="hl-12">+</span><span class="hl-10">,</span><span class="hl-13">[</span><span class="hl-10">0-9</span><span class="hl-13">]</span><span class="hl-12">+</span><span class="hl-13">(</span><span class="hl-10">,</span><span class="hl-13">[</span><span class="hl-10">0-9</span><span class="hl-13">]</span><span class="hl-12">*</span><span class="hl-13">)</span><span class="hl-12">{0,2}</span><span class="hl-11">$</span><span class="hl-10">/</span><span class="hl-1">.</span><span class="hl-3">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La direcci√≥n de una persona debe tener un formato v√°lido: [nombre de la calle],[n√∫mero de la casa], [piso], [puerta].&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">personaModel</span><span class="hl-1"> = </span><span class="hl-3">model</span><span class="hl-1">&lt;</span><span class="hl-5">PersonaDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-6">&#39;Personas&#39;</span><span class="hl-1">, </span><span class="hl-4">PersonaSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>proveedor.ts, cliente.ts</strong>: Los modelos de Proveedores y Clientes se basan en una estructura com√∫n representada por la interfaz PersonaDocumentInterface, heredando propiedades como id, nombre, contacto y direcci√≥n. Cada uno utiliza un esquema (ProveedorSchema y ClienteSchema) que, aunque vac√≠o en este caso, aprovecha las validaciones y tipos de datos definidos en el esquema de personas. Adem√°s, se utilizan discriminadores en Mongoose para crear los modelos (proveedorModel y clienteModel) basados en el modelo principal de personas, permitiendo una gesti√≥n modular y coherente de diferentes tipos de entidades en la base de datos.</p>
<blockquote>
<p>C√≥digo de Ejemplo: cliente.ts</p>
</blockquote>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-5">ClienteDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-5">PersonaDocumentInterface</span><span class="hl-1"> {</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">ClienteSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">&lt;</span><span class="hl-5">ClienteDocumentInterface</span><span class="hl-1">&gt;({});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">clienteModel</span><span class="hl-1"> = </span><span class="hl-4">personaModel</span><span class="hl-1">.</span><span class="hl-3">discriminator</span><span class="hl-1">(</span><span class="hl-6">&#39;Clientes&#39;</span><span class="hl-1">, </span><span class="hl-4">ClienteSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>transaccion.ts</strong>: Define un modelo y un esquema para una colecci√≥n de transacciones en una base de datos MongoDB utilizando Mongoose.</p>
<ol>
<li>Interfaz TransaccionDocumentInterface: Define la estructura de un documento de la colecci√≥n de Transacciones, especificando propiedades como id, fechas de inicio y fin, importe, muebles involucrados, persona asociada y tipo de transacci√≥n.</li>
<li>Esquema MuebleSchema: Define la estructura para representar un mueble en una transacci√≥n, con propiedades para el id del mueble y la cantidad involucrada.</li>
<li>Esquema TransaccionSchema: Define la estructura completa de un documento de la colecci√≥n de Transacciones. Cada campo del esquema especifica el tipo de datos, si es √∫nico y requerido, y contiene funciones de validaci√≥n para asegurar la integridad de los datos ingresados. El campo muebles_ utiliza el esquema MuebleSchema para representar una lista de muebles involucrados en la transacci√≥n. El campo persona_ se refiere a una persona asociada con la transacci√≥n, validando que el id de la persona exista en la base de datos.</li>
</ol>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-5">TransaccionDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-5">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id_</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">fechainicio_</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">fechafin_</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">importe_</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">muebles_</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">muebleId</span><span class="hl-1">: </span><span class="hl-5">Schema</span><span class="hl-1">.</span><span class="hl-5">Types</span><span class="hl-1">.</span><span class="hl-5">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">cantidad</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  }[],</span><br/><span class="hl-1">  </span><span class="hl-4">persona_</span><span class="hl-1">: </span><span class="hl-5">Schema</span><span class="hl-1">.</span><span class="hl-5">Types</span><span class="hl-1">.</span><span class="hl-5">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">tipo_</span><span class="hl-1"> : </span><span class="hl-5">string</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">MuebleSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">muebleId:</span><span class="hl-1"> </span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">cantidad:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">TransaccionSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">&lt;</span><span class="hl-5">TransaccionDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El id de una transacci√≥n no puede ser negativo.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> % </span><span class="hl-9">1</span><span class="hl-1"> !== </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El id de una transacci√≥n no puede ser un n√∫mero decimal.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">fechainicio_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &gt; </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">()) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La fecha de una transacci√≥n no puede ser futura.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">(</span><span class="hl-6">&#39;2020-01-01&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La fecha de una transacci√≥n no puede ser anterior a 2020.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> === </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">(</span><span class="hl-6">&#39;Invalid Date&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La fecha de una transacci√≥n no puede ser inv√°lida.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }    </span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">fechafin_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &gt; </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">()) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La fecha de una transacci√≥n no puede ser futura.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">(</span><span class="hl-6">&#39;2020-01-01&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La fecha de una transacci√≥n no puede ser anterior a 2020.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> === </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">(</span><span class="hl-6">&#39;Invalid Date&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;La fecha de una transacci√≥n no puede ser inv√°lida.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">importe_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El importe de una transacci√≥n no puede ser negativo.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">muebles_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">MuebleSchema</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-2">false</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">persona_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-6">&#39;Personas&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">validator</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-5">Schema</span><span class="hl-1">.</span><span class="hl-5">Types</span><span class="hl-1">.</span><span class="hl-5">ObjectId</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// Busca la persona en la base de datos</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">persona</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">personaModel</span><span class="hl-1">.</span><span class="hl-3">findById</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">// Devuelve true si la persona existe, false si no</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> !!</span><span class="hl-4">persona</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-3">message</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-4">props</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-6">`La persona asociada con ID </span><span class="hl-2">${</span><span class="hl-4">props</span><span class="hl-14">.</span><span class="hl-4">value</span><span class="hl-2">}</span><span class="hl-6"> no existe en la base de datos.`</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">tipo_:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">// enum: [&#39;Compra&#39;, &#39;Venta&#39;, &#39;Devoluci√≥n&#39;],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">transaccionModel</span><span class="hl-1"> = </span><span class="hl-3">model</span><span class="hl-1">&lt;</span><span class="hl-5">TransaccionDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-6">&#39;Transacciones&#39;</span><span class="hl-1">, </span><span class="hl-4">TransaccionSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>venta.ts, devolucion.ts, compra.ts</strong>: Los modelos de Ventas, Devoluciones y Compras se fundamentan en una estructura com√∫n definida por la interfaz TransaccionDocumentInterface, compartiendo propiedades como id, fechas de inicio y fin, importe, muebles involucrados, persona asociada y tipo de transacci√≥n. Cada uno emplea un esquema (VentaSchema, DevolucionSchema y CompraSchema) que, aunque inicialmente vac√≠o, se apoya en las validaciones y tipos de datos establecidos en el esquema de transacciones. Adem√°s, se aplican discriminadores en Mongoose para instanciar los modelos (ventaModel, devolucionModel y compraModel) derivados del modelo principal de transacciones, lo que facilita una gesti√≥n modular y uniforme de distintos tipos de transacciones en la base de datos.</p>
<blockquote>
<p>C√≥digo de Ejemplo: compra.ts</p>
</blockquote>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-5">CompraInterfaceDocument</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-5">TransaccionDocumentInterface</span><span class="hl-1"> {</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">CompraSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">&lt;</span><span class="hl-5">CompraInterfaceDocument</span><span class="hl-1">&gt;({});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">compraModel</span><span class="hl-1"> = </span><span class="hl-4">transaccionModel</span><span class="hl-1">.</span><span class="hl-3">discriminator</span><span class="hl-1">(</span><span class="hl-6">&#39;Compras&#39;</span><span class="hl-1">, </span><span class="hl-4">CompraSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>customers.ts</strong>: Define operaciones CRUD (Crear, Leer, Actualizar, Eliminar) para la gesti√≥n de clientes en una API REST utilizando Express y Mongoose.</p>
<ol>
<li>Operaci√≥n GET /customers: Busca clientes en la base de datos utilizando los par√°metros de la QueryString. Devuelve un objeto JSON con los clientes encontrados o un mensaje de error si no se encuentran.</li>
<li>Operaci√≥n GET /customers/:id: Busca un cliente en la base de datos utilizando su ID din√°micamente. Retorna un objeto JSON con el cliente encontrado o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n POST /customers: Guarda un nuevo cliente en la base de datos. Espera recibir los datos del cliente en el cuerpo de la solicitud y devuelve el cliente guardado como objeto JSON, o un mensaje de error si ocurre alg√∫n problema.</li>
<li>Operaci√≥n PATCH /customers: Actualiza clientes en la base de datos utilizando los par√°metros de la QueryString como filtros. Devuelve el cliente actualizado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n PATCH /customers/:id: Actualiza un cliente en la base de datos utilizando su ID din√°micamente. Retorna el cliente actualizado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n DELETE /customers: Elimina clientes de la base de datos utilizando los par√°metros de la QueryString como filtros. Devuelve el cliente eliminado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n DELETE /customers/:id: Elimina un cliente de la base de datos utilizando su ID din√°micamente. Retorna el cliente eliminado como objeto JSON o un mensaje de error si no se encuentra.</li>
</ol>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">customersRouter</span><span class="hl-1"> = </span><span class="hl-4">Express</span><span class="hl-1">.</span><span class="hl-3">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">customersRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">clientesEncontrados</span><span class="hl-1">: </span><span class="hl-5">PersonaDocumentInterface</span><span class="hl-1">[] = [</span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">clienteModel</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">)];</span><br/><span class="hl-1">    </span><span class="hl-4">clientesEncontrados</span><span class="hl-1"> = </span><span class="hl-4">clientesEncontrados</span><span class="hl-1">.</span><span class="hl-3">flat</span><span class="hl-1">().</span><span class="hl-3">filter</span><span class="hl-1">(</span><span class="hl-4">x</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">x</span><span class="hl-1"> !== </span><span class="hl-2">null</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">clientesEncontrados</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el cliente&#39;</span><span class="hl-1"> } : </span><span class="hl-4">clientesEncontrados</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al buscar el cliente&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">customersRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/customers/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">clienteEncontrado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">clienteModel</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">clienteEncontrado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el cliente&#39;</span><span class="hl-1"> } : </span><span class="hl-4">clienteEncontrado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al buscar el cliente&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">customersRouter</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><span class="hl-6">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">cliente</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">clienteModel</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">cliente</span><span class="hl-1">.</span><span class="hl-3">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">cliente</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al guardar el cliente&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">customersRouter</span><span class="hl-1">.</span><span class="hl-3">patch</span><span class="hl-1">(</span><span class="hl-6">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">clienteActualizado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">clienteModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">});</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">clienteActualizado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el cliente&#39;</span><span class="hl-1"> } : </span><span class="hl-4">clienteActualizado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al actualizar el cliente&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">customersRouter</span><span class="hl-1">.</span><span class="hl-3">patch</span><span class="hl-1">(</span><span class="hl-6">&#39;/customers/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">clienteActualizado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">clienteModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1"> , { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">});</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">clienteActualizado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el cliente&#39;</span><span class="hl-1"> } : </span><span class="hl-4">clienteActualizado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al actualizar el cliente&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">customersRouter</span><span class="hl-1">.</span><span class="hl-3">delete</span><span class="hl-1">(</span><span class="hl-6">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">clienteEliminado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">clienteModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">clienteEliminado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el cliente&#39;</span><span class="hl-1"> } : </span><span class="hl-4">clienteEliminado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al eliminar el cliente&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">customersRouter</span><span class="hl-1">.</span><span class="hl-3">delete</span><span class="hl-1">(</span><span class="hl-6">&#39;/customers/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">clienteEliminado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">clienteModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndDelete</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">clienteEliminado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el cliente&#39;</span><span class="hl-1"> } : </span><span class="hl-4">clienteEliminado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al eliminar el cliente&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><p><strong>furnitures.ts</strong>: Define operaciones CRUD (Crear, Leer, Actualizar, Eliminar) para la gesti√≥n de muebles en una API REST utilizando Express y Mongoose.</p>
<ol>
<li>Operaci√≥n GET /furnitures: Busca muebles en la base de datos utilizando los par√°metros de la QueryString. Retorna un objeto JSON con los muebles encontrados o un mensaje de error si no se encuentran.</li>
<li>Operaci√≥n GET /furnitures/:id: Busca un mueble en la base de datos utilizando su ID de manera din√°mica. Devuelve un objeto JSON con el mueble encontrado o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n POST /furnitures: Guarda un nuevo mueble en la base de datos. Espera recibir los datos del mueble en el cuerpo de la solicitud y devuelve el mueble guardado como objeto JSON, o un mensaje de error si ocurre alg√∫n problema.</li>
<li>Operaci√≥n PATCH /furnitures: Actualiza muebles en la base de datos utilizando los par√°metros de la QueryString como filtros. Devuelve el mueble actualizado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n PATCH /furnitures/:id: Actualiza un mueble en la base de datos utilizando su ID de manera din√°mica. Retorna el mueble actualizado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n DELETE /furnitures: Elimina muebles de la base de datos utilizando los par√°metros de la QueryString como filtros. Retorna el mueble eliminado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n DELETE /furnitures/:id: Elimina un mueble de la base de datos utilizando su ID de manera din√°mica. Retorna el mueble eliminado como objeto JSON o un mensaje de error si no se encuentra.</li>
</ol>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">Express</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-6">&#39;express&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">sillaModel</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-6">&#39;../models/muebles/silla.js&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">armarioModel</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-6">&#39;../models/muebles/armario.js&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">mesaModel</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-6">&#39;../models/muebles/mesa.js&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-4">MuebleDocumentInterface</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-6">&#39;../models/muebles/mueble.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">models</span><span class="hl-1">: </span><span class="hl-5">any</span><span class="hl-1">[] = [</span><span class="hl-4">sillaModel</span><span class="hl-1">, </span><span class="hl-4">armarioModel</span><span class="hl-1">, </span><span class="hl-4">mesaModel</span><span class="hl-1">];</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">furnitureRouter</span><span class="hl-1"> = </span><span class="hl-4">Express</span><span class="hl-1">.</span><span class="hl-3">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">: </span><span class="hl-5">MuebleDocumentInterface</span><span class="hl-1">[] = [];</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">models</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1"> = </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">.</span><span class="hl-3">flat</span><span class="hl-1">().</span><span class="hl-3">filter</span><span class="hl-1">(</span><span class="hl-4">x</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">x</span><span class="hl-1"> !== </span><span class="hl-2">null</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el mueble&#39;</span><span class="hl-1"> } : </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al buscar el mueble&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/furnitures/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">: </span><span class="hl-5">MuebleDocumentInterface</span><span class="hl-1">[] = [];</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">models</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-6">&quot;-1&quot;</span><span class="hl-1"> ? </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">() : </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1"> = </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">.</span><span class="hl-3">flat</span><span class="hl-1">().</span><span class="hl-3">filter</span><span class="hl-1">(</span><span class="hl-4">x</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">x</span><span class="hl-1"> !== </span><span class="hl-2">null</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el mueble&#39;</span><span class="hl-1"> } : </span><span class="hl-4">mueblesEncontrados</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al buscar el mueble&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><span class="hl-6">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// B√∫squeda en los modelos, y en caso de encontrar el mueble,</span><br/><span class="hl-1">    </span><span class="hl-7">// se actualiza la cantidad en vez de crear un nuevo mueble</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">models</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">id_</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">(</span><br/><span class="hl-1">          { </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-4">_id</span><span class="hl-1">}, </span><br/><span class="hl-1">          {</span><span class="hl-4">cantidad_:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-4">cantidad_</span><span class="hl-1"> + (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> ?? </span><span class="hl-9">1</span><span class="hl-1">)}, </span><br/><span class="hl-1">          {</span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">}</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1"> = </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">customObj</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1"> };</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1">) { </span><span class="hl-4">customObj</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> = </span><span class="hl-9">1</span><span class="hl-1">; }</span><br/><span class="hl-1">    </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">tipo_</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-6">&#39;silla&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">model</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">sillaModel</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-6">&#39;mesa&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">model</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">mesaModel</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-6">&#39;armario&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">model</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">armarioModel</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">400</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Tipo de mueble no v√°lido&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">model</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">) { </span><span class="hl-0">return</span><span class="hl-1">; }</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">model</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al guardar el mueble&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-3">patch</span><span class="hl-1">(</span><span class="hl-6">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">muebleActualizado</span><span class="hl-1"> = </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">models</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">muebleActualizado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">muebleActualizado</span><span class="hl-1"> !== </span><span class="hl-2">null</span><span class="hl-1">) { </span><span class="hl-0">break</span><span class="hl-1">; }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">muebleActualizado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el mueble&#39;</span><span class="hl-1"> } : </span><span class="hl-4">muebleActualizado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al actualizar el mueble&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-3">patch</span><span class="hl-1">(</span><span class="hl-6">&#39;/furnitures/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">muebleActualizado</span><span class="hl-1"> = </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">models</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">muebleActualizado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">muebleActualizado</span><span class="hl-1"> !== </span><span class="hl-2">null</span><span class="hl-1">) { </span><span class="hl-0">break</span><span class="hl-1">; }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">muebleActualizado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el mueble&#39;</span><span class="hl-1"> } : </span><span class="hl-4">muebleActualizado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al actualizar el mueble&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-3">delete</span><span class="hl-1">(</span><span class="hl-6">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">muebleEliminado</span><span class="hl-1"> = </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">models</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">// Si la cantidad es especificada en el cuerpo de la petici√≥n, se restar√° de la cantidad actual</span><br/><span class="hl-1">      </span><span class="hl-7">// en caso de que la cantidad sea mayor a la actual, se eliminar√° el mueble.</span><br/><span class="hl-1">      </span><span class="hl-7">// En caso de no especificarse, se eliminar√° el mueble</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({</span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id_</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1">) { </span><span class="hl-0">continue</span><span class="hl-1">; }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> === </span><span class="hl-2">undefined</span><span class="hl-1"> || </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> &lt; </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">muebleEliminado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOneAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">muebleEliminado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">(</span><br/><span class="hl-1">          { </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}, </span><br/><span class="hl-1">          {</span><span class="hl-4">cantidad_:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> - +</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1">}, </span><br/><span class="hl-1">          {</span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">}</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">muebleEliminado</span><span class="hl-1"> !== </span><span class="hl-2">null</span><span class="hl-1">) { </span><span class="hl-0">break</span><span class="hl-1">; }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">muebleEliminado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el mueble&#39;</span><span class="hl-1"> } : </span><span class="hl-4">muebleEliminado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al eliminar el mueble&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-3">delete</span><span class="hl-1">(</span><span class="hl-6">&#39;/furnitures/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">muebleEliminado</span><span class="hl-1"> = </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">models</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({</span><span class="hl-4">id_:req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1">) { </span><span class="hl-0">continue</span><span class="hl-1">; }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> === </span><span class="hl-2">undefined</span><span class="hl-1"> || </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> &lt; </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">muebleEliminado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOneAndDelete</span><span class="hl-1">({</span><span class="hl-4">id_:req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">});</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">muebleEliminado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">(</span><br/><span class="hl-1">          { </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}, </span><br/><span class="hl-1">          {</span><span class="hl-4">cantidad_:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> - +</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1">}, </span><br/><span class="hl-1">          {</span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">}</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">muebleEliminado</span><span class="hl-1"> !== </span><span class="hl-2">null</span><span class="hl-1">) { </span><span class="hl-0">break</span><span class="hl-1">; }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">muebleEliminado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el mueble&#39;</span><span class="hl-1"> } : </span><span class="hl-4">muebleEliminado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al eliminar el mueble&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>providers.ts</strong>: Define operaciones CRUD (Crear, Leer, Actualizar, Eliminar) para la gesti√≥n de proveedores en una API REST utilizando Express y Mongoose.</p>
<ol>
<li>Operaci√≥n GET /providers: Busca proveedores en la base de datos utilizando los par√°metros de la QueryString. Retorna un objeto JSON con los proveedores encontrados o un mensaje de error si no se encuentran.</li>
<li>Operaci√≥n GET /providers/:id: Busca un proveedor en la base de datos utilizando su ID de manera din√°mica. Devuelve un objeto JSON con el proveedor encontrado o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n POST /providers: Guarda un nuevo proveedor en la base de datos. Espera recibir los datos del proveedor en el cuerpo de la solicitud y devuelve el proveedor guardado como objeto JSON, o un mensaje de error si ocurre alg√∫n problema.</li>
<li>Operaci√≥n PATCH /providers: Actualiza proveedores en la base de datos utilizando los par√°metros de la QueryString como filtros. Devuelve el proveedor actualizado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n PATCH /providers/:id: Actualiza un proveedor en la base de datos utilizando su ID de manera din√°mica. Retorna el proveedor actualizado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n DELETE /providers: Elimina proveedores de la base de datos utilizando los par√°metros de la QueryString como filtros. Retorna el proveedor eliminado como objeto JSON o un mensaje de error si no se encuentra.</li>
<li>Operaci√≥n DELETE /providers/:id: Elimina un proveedor de la base de datos utilizando su ID de manera din√°mica. Retorna el proveedor eliminado como objeto JSON o un mensaje de error si no se encuentra.</li>
</ol>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">providersRouter</span><span class="hl-1"> = </span><span class="hl-4">Express</span><span class="hl-1">.</span><span class="hl-3">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">providersRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/providers&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">proveedoresEncontrados</span><span class="hl-1">: </span><span class="hl-5">PersonaDocumentInterface</span><span class="hl-1">[] = [</span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">proveedorModel</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">)];</span><br/><span class="hl-1">    </span><span class="hl-4">proveedoresEncontrados</span><span class="hl-1"> = </span><span class="hl-4">proveedoresEncontrados</span><span class="hl-1">.</span><span class="hl-3">flat</span><span class="hl-1">().</span><span class="hl-3">filter</span><span class="hl-1">(</span><span class="hl-4">x</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">x</span><span class="hl-1"> !== </span><span class="hl-2">null</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">proveedoresEncontrados</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el proveedor&#39;</span><span class="hl-1"> } : </span><span class="hl-4">proveedoresEncontrados</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al buscar el proveedor&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">providersRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/providers/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">proveedorEncontrado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">proveedorModel</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">proveedorEncontrado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el proveedor&#39;</span><span class="hl-1"> } : </span><span class="hl-4">proveedorEncontrado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al buscar el proveedor&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">providersRouter</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><span class="hl-6">&#39;/providers&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">proveedor</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">proveedorModel</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">proveedor</span><span class="hl-1">.</span><span class="hl-3">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">proveedor</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al guardar el proveedor&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">providersRouter</span><span class="hl-1">.</span><span class="hl-3">patch</span><span class="hl-1">(</span><span class="hl-6">&#39;/providers&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">proveedorActualizado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">proveedorModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">});</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">proveedorActualizado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el proveedor&#39;</span><span class="hl-1"> } : </span><span class="hl-4">proveedorActualizado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al actualizar el proveedor&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">providersRouter</span><span class="hl-1">.</span><span class="hl-3">patch</span><span class="hl-1">(</span><span class="hl-6">&#39;/providers/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">proveedorActualizado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">proveedorModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1"> , { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">});</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">proveedorActualizado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el proveedor&#39;</span><span class="hl-1"> } : </span><span class="hl-4">proveedorActualizado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al actualizar el proveedor&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">providersRouter</span><span class="hl-1">.</span><span class="hl-3">delete</span><span class="hl-1">(</span><span class="hl-6">&#39;/providers&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">proveedorEliminado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">proveedorModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">proveedorEliminado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el proveedor&#39;</span><span class="hl-1"> } : </span><span class="hl-4">proveedorEliminado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al eliminar el proveedor&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">providersRouter</span><span class="hl-1">.</span><span class="hl-3">delete</span><span class="hl-1">(</span><span class="hl-6">&#39;/providers/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">proveedorEliminado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">proveedorModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndDelete</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">condition</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-4">proveedorEliminado</span><span class="hl-1"> === </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">condition</span><span class="hl-1"> ? { </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No se encontr√≥ el proveedor&#39;</span><span class="hl-1"> } : </span><span class="hl-4">proveedorEliminado</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al eliminar el proveedor&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>transaction.ts</strong>: Permiten realizar operaciones CRUD en una API REST utilizando Express y Mongoose.</p>
<ol>
<li>Operaci√≥n GET /transactions/balance: Esta ruta calcula el saldo total de todas las transacciones en la base de datos y devuelve el promedio del saldo de todas las transacciones.</li>
<li>Operaciones GET /transactions y GET /transactions/:id: Estas rutas permiten buscar transacciones por diferentes criterios. La funci√≥n handleGet parece estar definida pero no se proporciona en el c√≥digo. Puedes asumir que esta funci√≥n maneja la l√≥gica para buscar transacciones seg√∫n los par√°metros de la QueryString o el ID din√°mico.</li>
<li>Operaci√≥n POST /transactions: Esta ruta guarda una nueva transacci√≥n en la base de datos. Antes de guardar la transacci√≥n, se parsean y validan los datos recibidos en el cuerpo de la solicitud. Se espera que exista una funci√≥n parseData que realice esta tarea. Tambi√©n se espera que exista una funci√≥n getModel que obtenga el modelo correcto para la transacci√≥n en funci√≥n del tipo de transacci√≥n especificado en el cuerpo de la solicitud.</li>
<li>Operaci√≥n PATCH /transactions/:id: Esta ruta actualiza una transacci√≥n existente en la base de datos. Primero, se recupera la transacci√≥n anterior. Si se especifican muebles en el cuerpo de la solicitud, se actualizan los muebles asociados a la transacci√≥n y se realiza un control de inventario. Si no se especifican muebles, se actualiza directamente la transacci√≥n. Se espera que exista una funci√≥n actualizarStock que maneje la l√≥gica para actualizar el inventario de muebles.</li>
<li>Operaci√≥n DELETE /transactions/:id: Esta ruta elimina una transacci√≥n existente de la base de datos. Se eliminan todas las instancias de transacciones asociadas al ID proporcionado. Tambi√©n se espera que exista una funci√≥n actualizarStock que maneje la l√≥gica para actualizar el inventario de muebles al eliminar una transacci√≥n.</li>
</ol>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">transaccionRouter</span><span class="hl-1"> = </span><span class="hl-4">Express</span><span class="hl-1">.</span><span class="hl-3">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">transaccionRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/transactions/balance&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">transactions</span><span class="hl-1">: </span><span class="hl-5">TransaccionDocumentInterface</span><span class="hl-1">[] = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">transactionsModels</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-3">find</span><span class="hl-1">({});</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">transactions</span><span class="hl-1"> || !</span><span class="hl-4">transactions</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">) { </span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">404</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({</span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;No hay transacciones disponibles&#39;</span><span class="hl-1">}) </span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> : </span><span class="hl-5">number</span><span class="hl-1"> = </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">t</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">transactions</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">sum</span><span class="hl-1"> += </span><span class="hl-4">t</span><span class="hl-1">.</span><span class="hl-4">importe_</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({</span><span class="hl-4">balance:</span><span class="hl-1"> </span><span class="hl-4">sum</span><span class="hl-1"> / </span><span class="hl-4">transactions</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">});</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al eliminar la transacci√≥n&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">transaccionRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/transactions&#39;</span><span class="hl-1">, </span><span class="hl-4">handleGet</span><span class="hl-1">);</span><br/><br/><span class="hl-4">transaccionRouter</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-6">&#39;/transactions/:id&#39;</span><span class="hl-1">, </span><span class="hl-4">handleGet</span><span class="hl-1">);</span><br/><br/><span class="hl-4">transaccionRouter</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><span class="hl-6">&#39;/transactions&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Parsear y validar datos</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> { </span><span class="hl-8">idPersona</span><span class="hl-1">, </span><span class="hl-8">importeTotal</span><span class="hl-1">, </span><span class="hl-8">mueblesCambiados</span><span class="hl-1"> } = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-3">parseData</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">// Crear instancia del modelo de transacci√≥n</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">TransaccionModel</span><span class="hl-1"> = </span><span class="hl-3">getModel</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">tipo_</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">muebles_</span><span class="hl-1"> = </span><span class="hl-4">mueblesCambiados</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">persona_</span><span class="hl-1"> = </span><span class="hl-4">idPersona</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">TransaccionModel</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">importe_:</span><span class="hl-1"> </span><span class="hl-4">importeTotal</span><span class="hl-1">,</span><br/><span class="hl-1">      ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-7">// Guardar el modelo de transacci√≥n</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">model</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">errorCustom</span><span class="hl-1"> = </span><span class="hl-4">error</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">Error</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al guardar la transacci√≥n&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">errorCustom</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">transaccionRouter</span><span class="hl-1">.</span><span class="hl-3">patch</span><span class="hl-1">(</span><span class="hl-6">&#39;/transactions/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// Se recupera la transacci√≥n anterior</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">transaccionAModificar</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">transactionsModels</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-7">// Si est√° definido el array muebles_ en el body de la petici√≥n, se itera sobre el array de muebles</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">muebles_</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">mueble</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">muebles_</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">muebleEncontrado</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">muebleModel</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">nombre_:</span><span class="hl-1"> </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">muebleId</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-7">// Si no se encuentra el mueble, se lanza un error</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">muebleEncontrado</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;El mueble no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-7">// Se calcula la diferencia entre la cantidad de muebles de la transacci√≥n anterior, y la cantidad de muebles de la transacci√≥n actual</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">muebleEnTransaccion</span><span class="hl-1"> = </span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-4">muebles_</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">((</span><span class="hl-4">m</span><span class="hl-1">: </span><span class="hl-5">any</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">m</span><span class="hl-1">.</span><span class="hl-4">muebleId</span><span class="hl-1">.</span><span class="hl-3">equals</span><span class="hl-1">(</span><span class="hl-4">muebleEncontrado</span><span class="hl-1">!.</span><span class="hl-4">_id</span><span class="hl-1">));</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">diferencia</span><span class="hl-1"> = </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> - </span><span class="hl-4">muebleEnTransaccion</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-6">`B√°sicamente </span><span class="hl-2">${</span><span class="hl-4">mueble</span><span class="hl-14">.</span><span class="hl-4">cantidad</span><span class="hl-2">}</span><span class="hl-6"> - </span><span class="hl-2">${</span><span class="hl-4">transaccionAModificar</span><span class="hl-14">.</span><span class="hl-4">muebles_</span><span class="hl-14">.</span><span class="hl-3">find</span><span class="hl-14">((</span><span class="hl-4">m</span><span class="hl-1">:</span><span class="hl-14"> </span><span class="hl-5">any</span><span class="hl-14">) </span><span class="hl-2">=&gt;</span><span class="hl-14"> </span><span class="hl-4">m</span><span class="hl-14">.</span><span class="hl-4">muebleId</span><span class="hl-14">.</span><span class="hl-3">equals</span><span class="hl-14">(</span><span class="hl-4">muebleEncontrado</span><span class="hl-14">.</span><span class="hl-4">_id</span><span class="hl-14">)).</span><span class="hl-4">cantidad</span><span class="hl-2">}</span><span class="hl-6"> = </span><span class="hl-2">${</span><span class="hl-4">diferencia</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-7">// Se tienen en cuenta</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-4">tipo_</span><span class="hl-1"> === </span><span class="hl-6">&#39;venta&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-4">diferencia</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1"> ? </span><span class="hl-4">muebleEnTransaccion</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> += </span><span class="hl-4">diferencia</span><span class="hl-1"> : </span><span class="hl-4">muebleEnTransaccion</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> -= </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-3">abs</span><span class="hl-1">(</span><span class="hl-4">diferencia</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-7">// Si la diferencia es menor que 0, se a√±aden los muebles al stock., en caso contrario, se suman          </span><br/><span class="hl-1">          </span><span class="hl-4">diferencia</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1"> ? </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> -= </span><span class="hl-4">diferencia</span><span class="hl-1"> : </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> += </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-3">abs</span><span class="hl-1">(</span><span class="hl-4">diferencia</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-6">`La nueva cantidad del mueble es </span><span class="hl-2">${</span><span class="hl-4">muebleEncontrado</span><span class="hl-14">.</span><span class="hl-4">cantidad_</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-4">diferencia</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1"> ? </span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-4">importe_</span><span class="hl-1"> += </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">precio_</span><span class="hl-1"> * </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-3">abs</span><span class="hl-1">(</span><span class="hl-4">diferencia</span><span class="hl-1">) : </span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-4">importe_</span><span class="hl-1"> -= </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">precio_</span><span class="hl-1"> * </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-3">abs</span><span class="hl-1">(</span><span class="hl-4">diferencia</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-6">`El nuevo importe del mueble es </span><span class="hl-2">${</span><span class="hl-4">transaccionAModificar</span><span class="hl-14">.</span><span class="hl-4">importe_</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-7">// Se comprueba que la cantidad de muebles en stock sea mayor o igual a 0, en caso contrario, se lanza un error</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;No hay suficientes muebles en stock&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-4">tipo_</span><span class="hl-1"> === </span><span class="hl-6">&#39;compra&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-7">// Si la diferencia es mayor que 0, se a√±aden los muebles al stock., en caso contrario, se restan</span><br/><span class="hl-1">          </span><span class="hl-4">diferencia</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1"> ? </span><span class="hl-4">muebleEnTransaccion</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> += </span><span class="hl-4">diferencia</span><span class="hl-1"> : </span><span class="hl-4">muebleEnTransaccion</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> -= </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-3">abs</span><span class="hl-1">(</span><span class="hl-4">diferencia</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-4">diferencia</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1"> ? </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> += </span><span class="hl-4">diferencia</span><span class="hl-1"> : </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> -= </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-3">abs</span><span class="hl-1">(</span><span class="hl-4">diferencia</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-4">diferencia</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1"> ? </span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-4">importe_</span><span class="hl-1"> -= </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">precio_</span><span class="hl-1"> * </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-3">abs</span><span class="hl-1">(</span><span class="hl-4">diferencia</span><span class="hl-1">) : </span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-4">importe_</span><span class="hl-1"> += </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">precio_</span><span class="hl-1"> * </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-3">abs</span><span class="hl-1">(</span><span class="hl-4">diferencia</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-7">// Se guarda el mueble</span><br/><span class="hl-1">        </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-3">save</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-4">importe_</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1"> || </span><span class="hl-4">muebleEncontrado</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1"> || </span><span class="hl-4">muebleEnTransaccion</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;No se pueden realizar transacciones con valores negativos&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-7">// Se borra del body los muebles, ya que no se pueden actualizar</span><br/><span class="hl-1">        </span><span class="hl-7">// Se actualiza la transacci√≥n</span><br/><span class="hl-1">        </span><span class="hl-2">delete</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">muebles_</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">prop</span><span class="hl-1"> </span><span class="hl-2">in</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">[</span><span class="hl-4">prop</span><span class="hl-1">]) {</span><br/><span class="hl-1">            </span><span class="hl-4">transaccionAModificar</span><span class="hl-1">[</span><span class="hl-4">prop</span><span class="hl-1">] = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">[</span><span class="hl-4">prop</span><span class="hl-1">];</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-4">transaccionAModificar</span><span class="hl-1">.</span><span class="hl-3">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">transactionsModels</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">({</span><span class="hl-4">id_:req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">}, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">transaccionAModificar</span><span class="hl-1"> ? </span><span class="hl-9">200</span><span class="hl-1">: </span><span class="hl-9">404</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">transaccionAModificar</span><span class="hl-1"> ?? {</span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Transacci√≥n no encontrada&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">customError</span><span class="hl-1"> = </span><span class="hl-4">error</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">Error</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al actualizar la transacci√≥n&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">customError</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">transaccionRouter</span><span class="hl-1">.</span><span class="hl-3">delete</span><span class="hl-1">(</span><span class="hl-6">&#39;/transactions/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">transaccionesEliminadas</span><span class="hl-1">: </span><span class="hl-5">TransaccionDocumentInterface</span><span class="hl-1">[] = [];</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">transactionsModels</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">// Iteramos sobre los muebles de la transacci√≥n que eliminamos para devolverlos al stock</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">transaccion</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">transaccion</span><span class="hl-1">) { </span><span class="hl-0">continue</span><span class="hl-1">; }</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-3">actualizarStock</span><span class="hl-1">(</span><span class="hl-4">transaccion</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">deleteMany</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">deletedCount</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) { </span><span class="hl-0">continue</span><span class="hl-1">; }</span><br/><span class="hl-1">      </span><span class="hl-4">transaccionesEliminadas</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">(</span><span class="hl-4">transaccion</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-4">transaccionesEliminadas</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1"> ? </span><span class="hl-9">404</span><span class="hl-1"> : </span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">transaccionesEliminadas</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1"> ? {</span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Transacci√≥n no encontrada.&#39;</span><span class="hl-1">} : </span><span class="hl-4">transaccionesEliminadas</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al eliminar la transacci√≥n&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>functionsHandle.ts</strong>: Implementa algunas funciones como:</p>
<ol>
<li>Operaci√≥n GET: La funci√≥n handleGet maneja las solicitudes GET a la ruta /transactions, tanto para buscar todas las transacciones como para buscar una transacci√≥n espec√≠fica por ID.</li>
<li>Operaci√≥n POST: La funci√≥n parseData se encarga de analizar y validar los datos de la transacci√≥n antes de guardarla en la base de datos. Se manejan casos como la b√∫squeda de la persona asociada a la transacci√≥n y la actualizaci√≥n del stock de muebles.</li>
<li>Operaci√≥n DELETE: La funci√≥n actualizarStock se utiliza para actualizar el stock de muebles despu√©s de eliminar una transacci√≥n. Esto asegura que el inventario se mantenga actualizado correctamente.</li>
</ol>
<pre><code class="language-ts"><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-5">request</span><span class="hl-1"> = </span><span class="hl-5">Express</span><span class="hl-1">.</span><span class="hl-5">Request</span><span class="hl-1">&lt;</span><span class="hl-5">any</span><span class="hl-1">&gt;;</span><br/><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-5">response</span><span class="hl-1"> = </span><span class="hl-5">Express</span><span class="hl-1">.</span><span class="hl-5">Response</span><span class="hl-1">&lt;</span><span class="hl-5">any</span><span class="hl-1">&gt;;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">handleGet</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">: </span><span class="hl-5">request</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">: </span><span class="hl-5">response</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> = { ...</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1"> };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-3">getFoundTransactions</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">));</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">error</span><span class="hl-1"> = </span><span class="hl-4">error</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">Error</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">status</span><span class="hl-1">(</span><span class="hl-9">404</span><span class="hl-1">).</span><span class="hl-3">send</span><span class="hl-1">({ </span><span class="hl-4">msg:</span><span class="hl-1"> </span><span class="hl-6">&#39;Error al buscar la transacci√≥n&#39;</span><span class="hl-1">, </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">getFoundTransactions</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">: </span><span class="hl-5">request</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">transaccionesEncontradas</span><span class="hl-1">: </span><span class="hl-5">TransaccionDocumentInterface</span><span class="hl-1">[] = [];</span><br/><span class="hl-1">  </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">model</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">transactionsModels</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-2">null</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-6">&quot;-1&quot;</span><span class="hl-1"> ? </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">() : </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">result</span><span class="hl-1">) { </span><span class="hl-0">continue</span><span class="hl-1">; }</span><br/><span class="hl-1">      </span><span class="hl-4">result</span><span class="hl-1"> = [</span><span class="hl-4">result</span><span class="hl-1">];</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">transaccion</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">duplicado</span><span class="hl-1">: </span><span class="hl-5">boolean</span><span class="hl-1"> = </span><span class="hl-2">false</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">x</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">transaccionesEncontradas</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">transaccion</span><span class="hl-1"> || </span><span class="hl-4">transaccion</span><span class="hl-1">.</span><span class="hl-4">id_</span><span class="hl-1"> === </span><span class="hl-4">x</span><span class="hl-1">.</span><span class="hl-4">id_</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-4">duplicado</span><span class="hl-1"> = </span><span class="hl-2">true</span><span class="hl-1">;</span><br/><span class="hl-1">          </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">duplicado</span><span class="hl-1">) { </span><span class="hl-0">continue</span><span class="hl-1">; }</span><br/><span class="hl-1">      </span><span class="hl-4">transaccionesEncontradas</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">(</span><span class="hl-4">transaccion</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">transaccionesEncontradas</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;No se encontr√≥ ninguna transacci√≥n.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">transaccionesEncontradas</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">parseData</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">: </span><span class="hl-5">request</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">objPersona</span><span class="hl-1">: </span><span class="hl-5">PersonaDocumentInterface</span><span class="hl-1"> | </span><span class="hl-5">null</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">personaModel</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">id_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">persona_</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">objPersona</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">`No se encontr√≥ la persona </span><span class="hl-2">${</span><span class="hl-4">req</span><span class="hl-14">.</span><span class="hl-4">body</span><span class="hl-14">.</span><span class="hl-4">persona_</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">idPersona</span><span class="hl-1"> = </span><span class="hl-4">objPersona</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">.</span><span class="hl-3">toString</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">importeTotal</span><span class="hl-1"> = </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">mueblesCambiados</span><span class="hl-1">: { </span><span class="hl-4">muebleId</span><span class="hl-1">: </span><span class="hl-5">Schema</span><span class="hl-1">.</span><span class="hl-5">Types</span><span class="hl-1">.</span><span class="hl-5">ObjectId</span><span class="hl-1">, </span><span class="hl-4">cantidad</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1"> }[] = [];</span><br/><span class="hl-1">  </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">mueble</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">muebles_</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">idMueble</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">muebleModel</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">nombre_:</span><span class="hl-1"> </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">muebleId</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">idMueble</span><span class="hl-1">) { </span><span class="hl-0">continue</span><span class="hl-1">; }</span><br/><span class="hl-1">    </span><span class="hl-7">// Si la transacci√≥n es de venta y no hay suficientes unidades en stock, se lanza un error</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">tipo_</span><span class="hl-1"> === </span><span class="hl-6">&#39;venta&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">idMueble</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> &lt; </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">`No hay suficientes unidades de </span><span class="hl-2">${</span><span class="hl-4">mueble</span><span class="hl-14">.</span><span class="hl-4">muebleId</span><span class="hl-2">}</span><span class="hl-6"> en stock`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-7">// Actualizar cantidad de muebles y calcular importe total</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">muebleModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">idMueble</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1"> }, { </span><span class="hl-4">cantidad_:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">tipo_</span><span class="hl-1"> === </span><span class="hl-6">&#39;venta&#39;</span><span class="hl-1"> ? </span><span class="hl-4">idMueble</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> - </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> : </span><span class="hl-4">idMueble</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> + </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-4">importeTotal</span><span class="hl-1"> += </span><span class="hl-4">idMueble</span><span class="hl-1">.</span><span class="hl-4">precio_</span><span class="hl-1"> * </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">mueblesCambiados</span><span class="hl-1">.</span><span class="hl-3">push</span><span class="hl-1">({ </span><span class="hl-4">muebleId:</span><span class="hl-1"> </span><span class="hl-4">idMueble</span><span class="hl-1">?.</span><span class="hl-4">_id</span><span class="hl-1">.</span><span class="hl-3">toString</span><span class="hl-1">(), </span><span class="hl-4">cantidad:</span><span class="hl-1"> </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">mueblesCambiados</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">muebles_</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-6">&#39;No se encontraron todos los muebles&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> { </span><span class="hl-4">idPersona</span><span class="hl-1">, </span><span class="hl-4">importeTotal</span><span class="hl-1">, </span><span class="hl-4">mueblesCambiados</span><span class="hl-1"> };</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">actualizarStock</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">: </span><span class="hl-5">TransaccionDocumentInterface</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">: </span><span class="hl-5">request</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">mueble</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">muebles_</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">idMueble</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">muebleModel</span><span class="hl-1">.</span><span class="hl-3">findOne</span><span class="hl-1">({ </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">muebleId</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">idMueble</span><span class="hl-1">) { </span><span class="hl-0">continue</span><span class="hl-1">; }</span><br/><span class="hl-1">    </span><span class="hl-7">// Si la transacci√≥n era una venta, devolvemos los muebles al stock</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">tipo_</span><span class="hl-1"> === </span><span class="hl-6">&#39;venta&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">muebleModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">muebleId</span><span class="hl-1"> }, { </span><span class="hl-4">cantidad_:</span><span class="hl-1"> </span><span class="hl-4">idMueble</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> + </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> }, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> });</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">// Si la transacci√≥n era una compra, quitamos los muebles del stock</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">muebleModel</span><span class="hl-1">.</span><span class="hl-3">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">muebleId</span><span class="hl-1"> }, { </span><span class="hl-4">cantidad_:</span><span class="hl-1"> </span><span class="hl-4">idMueble</span><span class="hl-1">.</span><span class="hl-4">cantidad_</span><span class="hl-1"> - </span><span class="hl-4">mueble</span><span class="hl-1">.</span><span class="hl-4">cantidad</span><span class="hl-1"> }, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
</li>
<li><p><strong>index.ts</strong>: Inicializa un servidor Express que proporciona endpoints para manejar operaciones relacionadas con muebles, clientes, proveedores y transacciones.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">app</span><span class="hl-1"> = </span><span class="hl-3">express</span><span class="hl-1">();</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-3">json</span><span class="hl-1">());</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-4">furnitureRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-4">providersRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-4">customersRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-4">transaccionRouter</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-3">green</span><span class="hl-1">(</span><span class="hl-6">&#39;[server_initiation] Server started!&#39;</span><span class="hl-1">));</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">listen</span><span class="hl-1">(</span><span class="hl-9">3000</span><span class="hl-1">);</span><br/><span class="hl-3">iniciarDB</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
</li>
</ul>
</li>
</ul>
<a id="md:4-conclusiones" class="tsd-anchor"></a><h1><a href="#md:4-conclusiones">4. Conclusiones</a></h1><p>Tras la realizaci√≥n de la pr√°ctica, se han aprendido las nociones b√°sicas para el manejo del Framework Express, as√≠ como la integraci√≥n con MongoDB y Mongoose para la gesti√≥n de la base de datos. Se ha logrado comprender c√≥mo implementar un servidor API REST utilizando Express y c√≥mo interactuar con la base de datos no relacional MongoDB mediante Mongoose.</p>
<p>Adem√°s, se ha adquirido experiencia en el despliegue de la aplicaci√≥n utilizando servicios como Atlas y Render, lo que ha permitido comprender el proceso completo desde el desarrollo hasta la puesta en producci√≥n de la aplicaci√≥n web.</p>
<a id="md:5-referencias" class="tsd-anchor"></a><h1><a href="#md:5-referencias">5. Referencias</a></h1><ul>
<li><a href="https://expressjs.com/es/">Documentaci√≥n de Express</a></li>
<li><a href="https://www.youtube.com/watch?v=JmJ1WUoUIK4">Curso de Express para NodeJS</a></li>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/nodejs-theory/nodejs-mongodb.html">Documentaci√≥n de MongoDB</a></li>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/nodejs-theory/nodejs-mongoose.html">Documentaci√≥n de Mongoose</a></li>
<li><a href="https://docs.render.com/">Documentaci√≥n de Render</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:√≠ndice"><span>√çndice</span></a><a href="#md:1-üìö-introducci√≥n-üìö"><span>1. üìö <wbr/>Introducci√≥n üìö</span></a><a href="#md:2-üß†-trabajo-previo-üß†"><span>2. üß† <wbr/>Trabajo previo üß†</span></a><a href="#md:3-üñ•Ô∏è-desarrollo-de-la-pr√°ctica-üñ•Ô∏è"><span>3. üñ•Ô∏è <wbr/>Desarrollo de la pr√°ctica üñ•Ô∏è</span></a><a href="#md:4-conclusiones"><span>4. <wbr/>Conclusiones</span></a><a href="#md:5-referencias"><span>5. <wbr/>Referencias</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>proyecto-final-dsi-grupo-b</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>